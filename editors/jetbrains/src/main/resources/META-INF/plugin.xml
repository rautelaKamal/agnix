<idea-plugin>
    <id>io.agnix.jetbrains</id>
    <name>agnix - Agent Config Linter</name>
    <vendor email="support@agnix.io" url="https://github.com/avifenesh/agnix">agnix</vendor>

    <description><![CDATA[
    Real-time validation for AI agent configuration files.

    <h2>Features</h2>
    <ul>
        <li>Validates SKILL.md, CLAUDE.md, AGENTS.md, and other agent configuration files</li>
        <li>Real-time diagnostics with quick fixes</li>
        <li>100+ validation rules across multiple categories</li>
        <li>Auto-download of LSP binary from GitHub releases</li>
        <li>Hover documentation for configuration fields</li>
    </ul>

    <h2>Supported Files</h2>
    <ul>
        <li>SKILL.md - Agent Skills specification</li>
        <li>CLAUDE.md / AGENTS.md variants - Project memory files</li>
        <li>.claude/settings.json and .claude/settings.local.json - Claude Code settings</li>
        <li>*.mcp.json - MCP server configurations</li>
        <li>.cursor/rules/*.mdc - Cursor rules</li>
        <li>.github/copilot-instructions.md - GitHub Copilot instructions</li>
    </ul>

    <h2>Quick Start</h2>
    <ol>
        <li>Install the plugin</li>
        <li>Open a project containing agent configuration files</li>
        <li>The plugin will automatically download and start the LSP server</li>
        <li>Issues will appear in the Problems panel with quick fixes</li>
    </ol>
    ]]></description>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.json</depends>
    <depends>com.redhat.devtools.lsp4ij</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Settings -->
        <applicationConfigurable
            parentId="tools"
            instance="io.agnix.jetbrains.settings.AgnixSettingsConfigurable"
            id="io.agnix.jetbrains.settings"
            displayName="agnix"/>
        <applicationService
            serviceImplementation="io.agnix.jetbrains.settings.AgnixSettings"/>

        <!-- File Types -->
        <fileType
            name="SKILL.md"
            implementationClass="io.agnix.jetbrains.filetype.SkillFileType"
            fieldName="INSTANCE"
            language="TEXT"
            fileNames="SKILL.md"/>

        <!-- Notifications -->
        <notificationGroup
            id="agnix.notifications"
            displayType="BALLOON"
            toolWindowId="Problems"/>

        <!-- Startup Activity -->
        <postStartupActivity
            implementation="io.agnix.jetbrains.startup.AgnixStartupActivity"/>
    </extensions>

    <extensions defaultExtensionNs="com.redhat.devtools.lsp4ij">
        <!-- LSP Server Support -->
        <server
            id="io.agnix.lsp"
            name="agnix"
            factoryClass="io.agnix.jetbrains.lsp.AgnixLspServerSupportProvider">
            <description><![CDATA[
            agnix Language Server for validating AI agent configuration files.
            ]]></description>
        </server>

        <!--
            File Pattern Mappings

            LSP4IJ file name patterns do not encode parent-directory semantics. We pair
            patterns with AgnixDocumentMatcher for path-aware checks so files like
            .vscode/settings.json are ignored while .claude/settings.json is matched.
        -->
        <fileNamePatternMapping
            patterns="SKILL.md;CLAUDE.md;CLAUDE.local.md;AGENTS.md;AGENTS.local.md;AGENTS.override.md;copilot-instructions.md;*.instructions.md;*.mdc;.cursorrules"
            serverId="io.agnix.lsp"
            languageId="markdown"
            documentMatcher="io.agnix.jetbrains.lsp.AgnixDocumentMatcher"/>
        <fileNamePatternMapping
            patterns="*.mcp.json;mcp.json;plugin.json;settings.json;settings.local.json"
            serverId="io.agnix.lsp"
            languageId="json"
            documentMatcher="io.agnix.jetbrains.lsp.AgnixDocumentMatcher"/>
    </extensions>

    <actions>
        <group id="agnix.ActionGroup" text="agnix" popup="true">
            <add-to-group group-id="ToolsMenu" anchor="last"/>

            <action id="agnix.RestartLspServer"
                class="io.agnix.jetbrains.actions.RestartLspServerAction"
                text="Restart Language Server"
                description="Restart the agnix language server"/>

            <action id="agnix.ValidateFile"
                class="io.agnix.jetbrains.actions.ValidateFileAction"
                text="Validate Current File"
                description="Manually trigger validation on the current file"/>

            <separator/>

            <action id="agnix.OpenSettings"
                class="io.agnix.jetbrains.actions.OpenSettingsAction"
                text="Settings"
                description="Open agnix settings"/>
        </group>
    </actions>
</idea-plugin>
